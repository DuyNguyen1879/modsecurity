# ---------------------------------------------------------------
# Sliqua WAF based on Comodo ModSecurity Rules
# Copyright (C) 2015 Sliqua Enterprise Hosting, Inc.
# Copyright (C) 2015 Comodo Security solutions All rights reserved.
# Please see the enclosed LICENCE file for full details.
# ---------------------------------------------------------------
# This is a FILE CONTAINING CHANGED or MODIFIED RULES FROM THE:
# OWASP ModSecurity Core Rule Set (CRS)
# Comodo Web Application Firewall
# ----------------------------------------------------------------

SecRule REQUEST_METHOD "@streq POST" \
	"id:220460,rev:1,chain,msg:'COMODO WAF: found CVE 2014-0793 attack',phase:2,deny,status:403,log"
SecRule ARGS_GET:option "@streq com_komento" \
	"chain"
SecRule ARGS_POST:website "@rx <"

SecRule REQUEST_METHOD "@streq POST" \
	"id:220461,rev:1,chain,msg:'COMODO WAF: found CVE 2014-0793 attack',phase:2,deny,status:403,log"
SecRule ARGS_GET:option "@streq com_komento" \
	"chain"
SecRule ARGS_POST:latitude "!@rx ^\d*$"

<LocationMatch "/index\.php">
SecRule REQUEST_METHOD "@streq POST" \
	"id:220470,rev:1,chain,msg:'COMODO WAF: found CVE 2014-0794 attack',phase:2,deny,status:403,log"
SecRule ARGS_POST:option "@streq com_jvcomment" \
	"chain"
SecRule ARGS_POST:id "!@rx ^\d+$"

</LocationMatch>
<LocationMatch "/index\.php">
SecRule REQUEST_METHOD "@streq POST" \
	"id:220520,rev:1,chain,msg:'COMODO WAF: found CVE 2013-3933 attack',phase:2,deny,status:403,log"
SecRule ARGS_POST:Itemid "!@rx ^$" \
	"chain"
SecRule ARGS_POST:user_name "@rx <"

</LocationMatch>
SecRule REQUEST_URI "index\.php" \
	"id:220680,rev:1,chain,msg:'COMODO WAF: found CVE-2013-5953 attack',deny,log,t:'htmlEntityDecode',t:'lowercase',multiMatch"
SecRule ARGS:option "com_multicalendar" \
	"chain"
SecRule ARGS:calid "@rx \D"

SecRule REQUEST_URI "index\.php" \
	"id:220681,rev:1,chain,msg:'COMODO WAF: found CVE-2013-5953 attack',deny,log,t:'htmlEntityDecode',t:'lowercase',multiMatch"
SecRule ARGS:option "com_multicalendar" \
	"chain"
SecRule ARGS:paletteDefault "!@rx /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/"

SecRule ARGS:id|ARGS:xhash "\"" \
	"id:220730,rev:1,chain,msg:'COMODO WAF: Found CVE-2013-5952 attack',deny,status:403,log,t:'none',t:'urlDecodeUni'"
SecRule REQUEST_FILENAME "/client/chat\.php" \
	"t:'none',t:'lowercase',t:'urlDecodeUni'"

SecRule ARGS_POST:toname "<" \
	"id:220731,rev:1,chain,msg:'COMODO WAF: Found CVE-2013-5952 attack',deny,status:403,log,t:'none',t:'urlDecodeUni'"
SecRule REQUEST_FILENAME "/client/plugins/upload/upload\.php" \
	"t:'none',t:'lowercase',t:'urlDecodeUni'"

SecRule REQUEST_URI "administrator/index\.php" \
	"id:220890,rev:1,chain,msg:'COMODO WAF: found CVE-2013-5955 Cross-site scripting (XSS) attack',deny,status:403,log,t:'none',t:'urlDecodeUni',multiMatch"
SecRule ARGS:option "com_pbbooking" \
	"chain"
SecRule ARGS:controller "manage" \
	"chain"
SecRule ARGS:task "create" \
	"chain"
SecRule ARGS:cal_id|ARGS:email|ARGS:firstname|ARGS:lastname|ARGS:mobile|ARGS:paletteDefault|ARGS:treatment_id "<"

SecRule REQUEST_FILENAME "@endsWith administrator/index.php" \
	"id:221600,rev:1,chain,msg:'COMODO WAF: Possible SQL Injection - CVE-2014-4960',phase:2,deny,status:403,log,t:'none',t:'urlDecodeUni',t:'normalisePath',t:'removeWhitespace',t:'lowercase',multiMatch"
SecRule ARGS:option "@streq com_youtubegallery" \
	"chain,t:'none',t:'urlDecodeUni',t:'compressWhitespace',t:'trim',multiMatch"
SecRule ARGS:listid|ARGS:themeid "@rx \D" \
	"t:'none',t:'urlDecodeUni',t:'compressWhitespace',t:'trim',multiMatch"

SecRule REQUEST_COOKIES:/^[\w]{32}$/ "@rx ^[\w]{26}$" \
	"id:240030,rev:2,chain,msg:'COMODO WAF: Possible Shell Upload Vulnerability in extplorer plugin for Joomla!',phase:2,deny,status:403,log,t:'none'"
SecRule ARGS_POST:option "@streq com_extplorer" \
	"chain,t:'none',t:'urlDecodeUni',t:'removeWhitespace',t:'lowercase',multiMatch"
SecRule FILES "@contains .php" \
	"t:'none',t:'urlDecodeUni',t:'lowercase',multiMatch"

SecRule REQUEST_FILENAME "@rx \.(bmp|csv|doc|gif|ico|jpg|jpeg|odg|odp|ods|odt|pdf|png|ppt|swf|txt|xcf|xls)$" \
	"id:240031,rev:2,chain,msg:'COMODO WAF: Blocking execution of an uploaded shell in Joomla!',phase:3,deny,status:403,log,t:'none',t:'urlDecodeUni',t:'htmlEntityDecode',t:'removeWhitespace',t:'lowercase',multiMatch"
SecRule RESPONSE_CONTENT_TYPE "@streq text/html" \
	"chain,t:'none',t:'lowercase',multiMatch"
SecRule REQUEST_FILENAME "@contains /images/" \
	"t:'none',t:'urlDecodeUni',t:'normalisePath',t:'lowercase',multiMatch"

SecRule REQUEST_FILENAME "@rx ([\/]+components[\/]+com_extplorer)" \
	"id:240032,rev:2,chain,msg:'COMODO WAF: Protecting extplorer Joomla Shell Upload Vulnerability',phase:2,capture,deny,status:403,log,t:'none',t:'urlDecodeUni',t:'lowercase',multiMatch"
SecRule TX:1 "@contains //"

SecRule REQUEST_FILENAME "@rx \/components\/com_(?:sexy|creative)contactform\/fileupload\/" \
	"id:240010,rev:2,chain,msg:'COMODO WAF: Protecting Joomla Creative Contact Form Files folder',phase:2,deny,status:403,t:'none',t:'urlDecodeUni',t:'lowercase',t:'normalisePath'"
SecRule FILES "@rx \.(?:php|js|pl)(?:\.|$)" \
	"t:'none',t:'urlDecodeUni',t:'lowercase'"

SecRule REQUEST_FILENAME "@rx \/components\/com_(?:sexy|creative)contactform\/fileupload\/(?:files\/)" \
	"id:240011,rev:2,chain,msg:'COMODO WAF: Protecting Joomla Creative Contact Form Files folder - Existing Shell',phase:2,deny,status:403,t:'none',t:'urlDecodeUni',t:'lowercase',t:'normalisePath'"
SecRule REQUEST_BASENAME "@rx \.(?:php|js|pl)(?:\.|$)" \
	"t:'none',t:'urlDecodeUni',t:'lowercase'"

SecRule ARGS_POST:option "@streq com_j2store" \
	"id:222370,rev:1,chain,msg:'COMODO WAF: SQL injection vulnerabilities in the J2Store (com_j2store) extension before 3.1.7 for Joomla (CVE-2015-6513)',phase:2,deny,status:403,log,t:'none',t:'lowercase'"
SecRule REQUEST_FILENAME "@endsWith index.php" \
	"chain,t:'none',t:'lowercase'"
SecRule ARGS_POST:view "@streq products" \
	"chain,t:'none',t:'lowercase'"
SecRule ARGS_POST:sortby "@rx \W" \
	"t:'none'"

SecRule ARGS_POST:option "@streq com_j2store" \
	"id:222371,rev:1,chain,msg:'COMODO WAF: SQL injection vulnerabilities in the J2Store (com_j2store) extension before 3.1.7 for Joomla (CVE-2015-6513)',phase:2,deny,status:403,log,t:'none',t:'lowercase'"
SecRule REQUEST_FILENAME "@endsWith index.php" \
	"chain,t:'none',t:'lowercase'"
SecRule ARGS_POST:view "@streq products" \
	"chain,t:'none',t:'lowercase'"
SecRule ARGS_POST:/manufacturer_id(?:s\[\d*])?/ "@rx \D" \
	"t:'none'"

SecRule ARGS:option "@streq com_googlesearch_cse" \
	"id:222380,rev:1,chain,msg:'COMODO WAF: XSS vulnerability in the googleSearch (CSE) (com_googlesearch_cse) component 3.0.2 for Joomla! (CVE-2015-6919)',phase:2,deny,status:403,log,t:'none'"
SecRule ARGS:q "@contains \"" \
	"t:'none',t:'urlDecodeUni'"

SecRule &SESSION:joomla_session "@ge 1" \
	"id:222401,rev:1,chain,msg:'COMODO WAF: Start tracking Joomla! com_templates session',phase:2,pass,nolog,t:'none'"
SecRule ARGS:option "@streq com_templates" \
	"chain,t:'none',t:'lowercase'"
SecRule &ARGS:task "@eq 0" \
	"chain,t:'none'"
SecRule REQUEST_METHOD "@streq get" \
	"expirevar:'SESSION.joomla_comtemplates=300',setvar:'SESSION.joomla_comtemplates=1',t:'none',t:'lowercase'"

SecRule &SESSION:joomla_session "@ge 1" \
	"id:222402,rev:1,chain,msg:'COMODO WAF: Cross-site request forgery (CSRF) vulnerability in the com_templates component in Joomla! 3.2.0 through 3.3.x and 3.4.x before 3.4.6 (CVE-2015-8563)',phase:2,deny,status:403,log,t:'none'"
SecRule ARGS:option "@streq com_templates" \
	"chain,t:'none',t:'lowercase'"
SecRule ARGS:task "@pm template.createFile template.renameFile template.delete template.createFolder template.deleteFolder template.uploadFile style.save2copy template.copyFile template.extractArchive" \
	"chain,t:'none'"
SecRule &SESSION:joomla_comtemplates "!@ge 1" \
	"t:'none'"

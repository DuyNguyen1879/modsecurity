# ---------------------------------------------------------------
# Comodo ModSecurity Rules
# Copyright (C) 2015 Comodo Security solutions All rights reserved.
#
# The COMODO SECURITY SOLUTIONS Mod Security Rule Set is distributed under
# THE COMODO SECURITY SOLUTIONS END USER LICENSE AGREEMENT,
# Please see the enclosed LICENCE file for full details.
# ---------------------------------------------------------------
# This is a FILE CONTAINING CHANGED or MODIFIED RULES FROM THE:
# OWASP ModSecurity Core Rule Set (CRS)
# ---------------------------------------------------------------

SecRule REQUEST_METHOD "@streq POST" \
	"id:220460,chain,msg:'COMODO WAF: found CVE 2014-0793 attack',phase:2,deny,status:403,log"
SecRule ARGS_GET:option "@streq com_komento" \
	"chain"
SecRule ARGS_POST:website "@rx <"

SecRule REQUEST_METHOD "@streq POST" \
	"id:220461,chain,msg:'COMODO WAF: found CVE 2014-0793 attack',phase:2,deny,status:403,log"
SecRule ARGS_GET:option "@streq com_komento" \
	"chain"
SecRule ARGS_POST:latitude "!@rx ^\d*$"

<LocationMatch "/index\.php">
SecRule REQUEST_METHOD "@streq POST" \
	"id:220470,chain,msg:'COMODO WAF: found CVE 2014-0794 attack',phase:2,deny,status:403,log"
SecRule ARGS_POST:option "@streq com_jvcomment" \
	"chain"
SecRule ARGS_POST:id "!@rx ^\d+$"

</LocationMatch>
<LocationMatch "/index\.php">
SecRule REQUEST_METHOD "@streq POST" \
	"id:220520,chain,msg:'COMODO WAF: found CVE 2013-3933 attack',phase:2,deny,status:403,log"
SecRule ARGS_POST:Itemid "!@rx ^$" \
	"chain"
SecRule ARGS_POST:user_name "@rx <"

</LocationMatch>
SecRule REQUEST_URI "index\.php" \
	"id:220680,chain,msg:'COMODO WAF: found CVE-2013-5953 attack',deny,log,t:'htmlEntityDecode',t:'lowercase',multiMatch"
SecRule ARGS:option "com_multicalendar" \
	"chain"
SecRule ARGS:calid "@rx \D"

SecRule REQUEST_URI "index\.php" \
	"id:220681,chain,msg:'COMODO WAF: found CVE-2013-5953 attack',deny,log,t:'htmlEntityDecode',t:'lowercase',multiMatch"
SecRule ARGS:option "com_multicalendar" \
	"chain"
SecRule ARGS:paletteDefault "!@rx /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/"

SecRule ARGS:id|ARGS:xhash "\"" \
	"id:220730,chain,msg:'COMODO WAF: Found CVE-2013-5952 attack',deny,status:403,log,t:'none',t:'urlDecodeUni'"
SecRule REQUEST_FILENAME "/client/chat\.php" \
	"t:'none',t:'lowercase',t:'urlDecodeUni'"

SecRule ARGS_POST:toname "<" \
	"id:220731,chain,msg:'COMODO WAF: Found CVE-2013-5952 attack',deny,status:403,log,t:'none',t:'urlDecodeUni'"
SecRule REQUEST_FILENAME "/client/plugins/upload/upload\.php" \
	"t:'none',t:'lowercase',t:'urlDecodeUni'"

SecRule REQUEST_URI "administrator/index\.php" \
	"id:220890,chain,msg:'COMODO WAF: found CVE-2013-5955 Cross-site scripting (XSS) attack',deny,status:403,log,t:'none',t:'urlDecodeUni',multiMatch"
SecRule ARGS:option "com_pbbooking" \
	"chain"
SecRule ARGS:controller "manage" \
	"chain"
SecRule ARGS:task "create" \
	"chain"
SecRule ARGS:cal_id|ARGS:email|ARGS:firstname|ARGS:lastname|ARGS:mobile|ARGS:paletteDefault|ARGS:treatment_id "<"

SecRule REQUEST_FILENAME "@endsWith administrator/index.php" \
	"id:221600,chain,msg:'COMODO WAF: Possible SQL Injection - CVE-2014-4960',phase:2,deny,status:403,log,t:'none',t:'urlDecodeUni',t:'normalisePath',t:'removeWhitespace',t:'lowercase',multiMatch"
SecRule ARGS:option "@streq com_youtubegallery" \
	"chain,t:'none',t:'urlDecodeUni',t:'compressWhitespace',t:'trim',multiMatch"
SecRule ARGS:listid|ARGS:themeid "@rx \D" \
	"t:'none',t:'urlDecodeUni',t:'compressWhitespace',t:'trim',multiMatch"

SecRule REQUEST_COOKIES:/^[\w]{32}$/ "@rx ^[\w]{26}$" \
	"id:240030,chain,msg:'COMODO WAF: Possible Shell Upload Vulnerability in extplorer plugin for Joomla!',phase:2,deny,status:403,log,t:'none'"
SecRule ARGS_POST:option "@streq com_extplorer" \
	"chain,t:'none',t:'urlDecodeUni',t:'removeWhitespace',t:'lowercase',multiMatch"
SecRule FILES "@contains .php" \
	"t:'none',t:'urlDecodeUni',t:'lowercase',multiMatch"

SecRule REQUEST_FILENAME "@rx \.(bmp|csv|doc|gif|ico|jpg|jpeg|odg|odp|ods|odt|pdf|png|ppt|swf|txt|xcf|xls)$" \
	"id:240031,chain,msg:'COMODO WAF: Blocking execution of an uploaded shell in Joomla!',phase:3,deny,status:403,log,t:'none',t:'urlDecodeUni',t:'htmlEntityDecode',t:'removeWhitespace',t:'lowercase',multiMatch"
SecRule RESPONSE_CONTENT_TYPE "@streq text/html" \
	"chain,t:'none',t:'lowercase',multiMatch"
SecRule REQUEST_FILENAME "@contains /images/" \
	"t:'none',t:'urlDecodeUni',t:'normalisePath',t:'lowercase',multiMatch"

SecRule REQUEST_FILENAME "@rx ([\/]+components[\/]+com_extplorer)" \
	"id:240032,chain,msg:'COMODO WAF: Protecting extplorer Joomla Shell Upload Vulnerability',phase:2,capture,deny,status:403,log,t:'none',t:'urlDecodeUni',t:'lowercase',multiMatch"
SecRule TX:1 "@contains //"

SecRule REQUEST_FILENAME "@rx \/components\/com_(?:sexy|creative)contactform\/fileupload\/" \
	"id:240010,chain,msg:'COMODO WAF: Protecting Joomla Creative Contact Form Files folder',phase:2,deny,status:403,t:'none',t:'urlDecodeUni',t:'lowercase',t:'normalisePath'"
SecRule FILES "@rx \.(?:php|js|pl)(?:\.|$)" \
	"t:'none',t:'urlDecodeUni',t:'lowercase'"

SecRule REQUEST_FILENAME "@rx \/components\/com_(?:sexy|creative)contactform\/fileupload\/(?:files\/)" \
	"id:240011,chain,msg:'COMODO WAF: Protecting Joomla Creative Contact Form Files folder - Existing Shell',phase:2,deny,status:403,t:'none',t:'urlDecodeUni',t:'lowercase',t:'normalisePath'"
SecRule REQUEST_BASENAME "@rx \.(?:php|js|pl)(?:\.|$)" \
	"t:'none',t:'urlDecodeUni',t:'lowercase'"

